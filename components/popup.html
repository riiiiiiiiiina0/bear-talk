<!DOCTYPE html>
<html>

<!-- ===== HEAD SECTION ===== -->
<!-- Document metadata, stylesheets, and scripts -->

<head>
  <meta charset="utf-8" />
  <title>Bear Talk - AI Chat</title>
  <link href="../libs/daisyui@5.css" rel="stylesheet" type="text/css" />
  <script src="../libs/tailwindcss@4.js"></script>
</head>

<!-- ===== MAIN BODY ===== -->
<!-- Fixed size popup window (400x600px) with flexbox layout -->

<body class="font-sans w-[520px] h-[600px] m-0 p-0 flex flex-col">

  <!-- ===== MAIN CONTENT AREA ===== -->
  <!-- Takes up most of the space, contains the prompt textarea -->
  <div class="flex-1 flex flex-col">
    <!-- Large textarea for user to type prompts -->
    <textarea id="prompt-textarea"
      class="textarea flex-1 w-full border-none outline-none focus:!border-none focus:!outline-none focus:!shadow-none resize-none"
      placeholder="Type your prompt here, Enter to send"></textarea>
  </div>

  <div class="flex flex-col bg-base-300 rounded-xl m-2 drop-shadow-lg">
    <!-- ===== SELECTED TABS ===== -->
    <div class="h-10 px-2 py-1 mx-2 flex flex-row items-center gap-2 hidden" id="selected-tabs">
    </div>

    <!-- ===== BOTTOM TOOLBAR ===== -->
    <!-- Fixed height toolbar with AI, Prompts, and Tabs buttons -->
    <div class="border-t border-base-100 flex flex-row items-center gap-2 px-1 pt-1 m-2 mt-0">

      <!-- AI Button - Opens AI provider selection popup, shows selected provider icon -->
      <button
        class="flex flex-row items-center gap-1 bg-transparent border-none cursor-pointer p-2 rounded-lg transition-colors duration-200 hover:bg-base-200"
        id="ai-btn">
        <!-- Dynamic provider icon (updated by JavaScript) -->
        <img id="ai-btn-icon" class="w-6 h-6 rounded"
          src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23666'%3E%3Cpath d='M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z'/%3E%3C/svg%3E"
          alt="AI Provider">
        <span class="text-xs font-medium">AI</span>
      </button>

      <!-- Prompts Button - Opens saved prompts selection popup -->
      <button
        class="flex flex-row items-center gap-1 bg-transparent border-none cursor-pointer p-2 rounded-lg transition-colors duration-200 hover:bg-base-200"
        id="prompts-btn">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"
          class="size-6">
          <path stroke-linecap="round" stroke-linejoin="round"
            d="M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z" />
        </svg>
        <span class="text-xs font-medium">/ Prompts</span>
      </button>

      <!-- Tabs Button - Opens browser tabs selection popup -->
      <button
        class="flex flex-row items-center gap-1 bg-transparent border-none cursor-pointer p-2 rounded-lg transition-colors duration-200 hover:bg-base-200"
        id="tabs-btn">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"
          class="size-6">
          <path stroke-linecap="round" stroke-linejoin="round"
            d="M9 12.75 11.25 15 15 9.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
        </svg>
        <span class="text-xs font-medium">@ Tabs</span>
      </button>

      <!-- Files Button - Open local file selector -->
      <button
        class="flex flex-row items-center gap-1 bg-transparent border-none cursor-pointer p-2 rounded-lg transition-colors duration-200 hover:bg-base-200"
        id="files-btn">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"
          class="size-6">
          <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
        </svg>
        <span class="text-xs font-medium">Files</span>
        <span id="files-count" class="ml-1 text-xs font-semibold text-primary"></span>
      </button>

      <div class="flex-1"></div>

      <!-- Hidden file input -->
      <input type="file" id="files-input" multiple accept="image/*,.pdf,text/*" class="hidden" />

      <!-- Download Button - Downloads selected tabs as Markdown -->
      <button
        class="flex flex-row items-center gap-1 bg-transparent border-none cursor-pointer p-2 rounded-lg transition-colors duration-200 hover:bg-base-200"
        id="download-btn" title="Download selected tabs as Markdown">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"
          class="size-6">
          <path stroke-linecap="round" stroke-linejoin="round"
            d="M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m.75 12 3 3m0 0 3-3m-3 3v-6m-1.5-9H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z" />
        </svg>
      </button>

      <!-- Send Button - Sends prompt to LLM -->
      <button
        class="flex flex-row items-center gap-1 bg-transparent border-none cursor-pointer p-2 rounded-lg transition-colors duration-200 hover:bg-base-200"
        id="send-btn">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"
          class="size-6">
          <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 10.5 12 3m0 0 7.5 7.5M12 3v18" />
        </svg>
      </button>
    </div>
  </div>

  <!-- ===== POPUP MENUS ===== -->
  <!-- Hidden by default, shown when toolbar buttons are clicked -->

  <!-- AI Selection Popup - Shows ChatGPT, Gemini, Claude, Perplexity options -->
  <div id="ai-popup"
    class="fixed bottom-20 left-4 right-4 bg-base-100 border border-base-300 rounded-xl shadow-2xl z-20 translate-y-full opacity-0 transition-all duration-300 max-h-[300px] overflow-hidden flex flex-col invisible">
    <!-- Popup header -->
    <div class="px-4 pt-4 pb-2 border-b border-base-300 font-semibold">Select AI Provider</div>
    <!-- AI providers list (populated by JavaScript) -->
    <div class="flex-1 overflow-y-auto p-2" id="ai-list">
      <!-- AI providers will be populated by JavaScript -->
    </div>
    <!-- Other options -->
    <div class="px-4 py-2 border-t border-base-300">
      <div class="flex flex-col gap-2">
        <!-- Reply Language -->
        <div class="flex items-center justify-between">
          <label for="reply-language-select" class="font-medium text-sm">Reply Language</label>
          <select id="reply-language-select" class="select select-sm">
            <option value="en">English</option>
            <option value="zh">Chinese</option>
          </select>
        </div>
        <!-- Search Hints for ChatGPT -->
        <div id="search-hints-container" class="flex items-center justify-between hidden">
          <label for="search-hints-checkbox" class="font-medium text-sm">Include search hints</label>
          <input type="checkbox" id="search-hints-checkbox" class="toggle toggle-sm" />
        </div>
      </div>
    </div>
  </div>

  <!-- Prompts Selection Popup - Shows saved prompts with search -->
  <div id="prompts-popup"
    class="fixed bottom-20 left-4 right-4 bg-base-100 border border-base-300 rounded-xl shadow-2xl z-20 translate-y-full opacity-0 transition-all duration-300 max-h-[300px] overflow-hidden flex flex-col invisible">
    <!-- Popup header -->
    <div class="px-4 pt-4 pb-2 border-b border-base-300 font-semibold">Select Prompt</div>
    <!-- Prompts content area -->
    <div class="flex-1 overflow-y-auto p-2">
      <!-- Scrollable prompts list (populated by JavaScript) -->
      <div id="prompts-list">
        <!-- Prompts will be populated by JavaScript -->
      </div>
    </div>
    <!-- Search input at bottom -->
    <div class="p-2 px-4 pb-4 border-t border-base-300">
      <input type="text" class="input input-sm w-full" id="prompts-search" placeholder="Search prompts...">
    </div>
  </div>

  <!-- Tabs Selection Popup - Shows browser tabs with search -->
  <div id="tabs-popup"
    class="fixed bottom-20 left-4 right-4 bg-base-100 border border-base-300 rounded-xl shadow-2xl z-20 translate-y-full opacity-0 transition-all duration-300 max-h-[300px] overflow-hidden flex flex-col invisible">
    <!-- Popup header -->
    <div class="px-4 pt-4 pb-2 border-b border-base-300 font-semibold">Select Tabs</div>
    <!-- Tabs content area -->
    <div class="flex-1 overflow-y-auto p-2">
      <!-- Scrollable tabs list (populated by JavaScript) -->
      <div id="tabs-list">
        <!-- Tabs will be populated by JavaScript -->
      </div>
    </div>
    <!-- Search input at bottom -->
    <div class="p-2 px-4 pb-4 border-t border-base-300">
      <input type="text" class="input input-sm w-full" id="tabs-search" placeholder="Search tabs...">
    </div>
  </div>

  <!-- ===== OVERLAY & LOADING ===== -->
  <!-- Transparent overlay to close popups when clicking outside -->
  <div id="overlay" class="fixed inset-0 bg-transparent z-10 hidden"></div>

  <!-- Loading spinner overlay (shown during operations) -->
  <div id="loading-overlay" class="hidden fixed inset-0 flex items-center justify-center bg-black/50 z-50">
    <span class="loading loading-spinner loading-xl"></span>
  </div>

  <!-- ===== JAVASCRIPT ===== -->
  <!-- Main popup functionality script -->
  <script src="popup.js" type="module"></script>
</body>

</html>